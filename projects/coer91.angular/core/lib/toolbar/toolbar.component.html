<header>
    <h2>
        <div class="title">
            <coer-button
                type="icon-rounded"
                icon="i91-menu"
                height="20px"
                color="navigation"
                (onClick)="onClickToogle.emit()"
            ></coer-button>

            <span class="title-project">
                <span>{{ title }}</span>
                
                @if(_icon().length > 0) {
                    <i [class]="_icon()"></i> 
                }
            </span>
        </div> 

        <div id="coer91-toolbar-user" class="user" (click)="_isCollapsed.set(!_isCollapsed())"> 
            <figure>
                <div class="user-image" [ngStyle]="{ backgroundImage: `url('${userImage() | noImage: 'USER'}')` }"></div>
                
                @if(_showIdentity()) {
                    <div class="user-identity">
                        <p>{{ user()?.fullName }}</p>
                        <p>{{ user()?.role     }}</p>
                    </div>
                }
            </figure>

            <ul [ngClass]="{ 'absolute-menu': !_showIdentity() }" [ngStyle]="{ 'max-height' : (_isCollapsed() ? '0px' : '175px') }">
                @for(item of _menu(); track item.index) {
                    <li (click)="_SelectMenu(item)"> 
                        @if((item?.icon || '').length > 0) {
                            <span class="icon-container-option">
                                <i [class]="item?.icon"></i> 
                            </span>
                        } 

                        <span class="display-property-option">{{ item?.label || '' }}</span>    
                    </li>
                }
            </ul>
        </div>
    </h2>
</header> 


<coer-modal #profileModal [title]="user()?.fullName || ''" icon="i91-user-fill">
    {{ user() | json }}
</coer-modal>


<coer-modal #passwordModal title="Change Password" icon="i91-lock-fill" (onClose)="_ResetPassword()" (onOpen)="passwordRef.Focus()">
    <div class="flex-wrap margin-top-15px max-width-300px margin-x-10px">
        <!-- Password -->
        <div class="flex-basis-300px flex-grow-1">
            <coer-secretbox
                #passwordRef
                label="Password"
                [(ngModel)]="_password" 
                [isLoading]="_isLoading()" 
                [isInvalid]="_isInvalidPassword()"
                marginTop="5px"
                (onKeyupEnter)="confirmRef.Focus()"
            ></coer-secretbox> 
        </div> 

        <!-- Confirm -->
        <div class="flex-basis-300px flex-grow-1">
            <coer-secretbox
                #confirmRef
                label="Confirm"
                [(ngModel)]="_confirm" 
                [isLoading]="_isLoading()" 
                [isInvalid]="_isInvalidConfirm()"
                marginTop="5px"
                marginBottom="10px"
                (onKeyupEnter)="buttonRef()?.Click()"
            ></coer-secretbox> 
        </div>
    </div>
    
    <ng-template templateRef="modal-footer">
        <coer-button
            #buttonRef
            label="Update"
            icon="save"
            color="success"
            [isLoading]="_isLoading()"
            marginRight="10px"
            [isReadonly]="_disableUpdatePassword()"
            (onClick)="onUpdatePassword.emit(_password())"
        ></coer-button>
    </ng-template>
</coer-modal>