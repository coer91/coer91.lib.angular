<header>
    <h2>
        <div class="title">
            <coer-button
                type="icon-rounded"
                icon="i91-menu"
                height="20px"
                color="navigation"
                (onClick)="onClickToogle.emit()"
            ></coer-button>

            <span class="title-project">
                <span>{{ title }}</span>
                
                @if(_icon().length > 0) {
                    <i [class]="_icon()"></i> 
                }
            </span>
        </div> 

        @if(_isLoading()) {
            <div class="user-loading">
                <span>Loading</span>
                <div class="user-loading-image" [ngStyle]="{ backgroundImage: `url('coer91/images/loading.gif')` }"></div>
            </div>
        }

         
        <div id="coer91-toolbar-user" 
            class="user" 
            [ngClass]="{ 'display-none' : (_isLoading() || !showUserData()) }" 
            (click)="_isCollapsed.set(!_isCollapsed())"> 
            
            <figure>
                <div class="user-image" [ngStyle]="{ backgroundImage: `url('${userImage() | noImage: 'USER'}')` }"></div>
                
                @if(_showIdentity()) {
                    <div class="user-identity">
                        <p>{{ user()?.fullName }}</p>
                        <p>{{ user()?.role     }}</p>
                    </div>
                }
            </figure>
    
            <ul [ngClass]="{ 'absolute-menu': !_showIdentity() }"
                [ngStyle]="{ 
                    'max-height': (_isCollapsed() ? '0px' : '175px'),
                    'min-width' : (_isCollapsed() ? '0px' : '200px') 
                }">
                @for(item of _menu(); track item.__index__) {
                    <li (click)="_SelectMenu(item)"> 
                        @if((item?.icon || '').length > 0) {
                            <span class="icon-container-option">
                                <i [class]="item?.icon"></i> 
                            </span>
                        } 
    
                        <span class="display-property-option">{{ item?.label || '' }}</span>    
                    </li>
                }
            </ul>
        </div> 
    </h2>
</header> 


<coer-modal #profileModal [title]="user()?.fullName || ''" icon="i91-user-fill">
    <div class="user-profile">
        <!-- User -->
        <div class="flex-basis">
            <coer-textbox 
                label="User"
                [ngModel]="user()?.user" 
                [isLoading]="_isLoading()" 
                [isReadonly]="true"
            ></coer-textbox> 
        </div>

        <!-- User Number -->
        @if(IsNotOnlyWhiteSpace(user()?.userNumber)) {
            <div class="flex-basis">
                <coer-textbox 
                    label="User Number"
                    [ngModel]="user()?.userNumber" 
                    [isLoading]="_isLoading()" 
                    [isReadonly]="true"
                ></coer-textbox> 
            </div>
        }

        <!-- Email -->
        @if(IsNotOnlyWhiteSpace(user()?.email)) {
            <div class="flex-basis">
                <coer-textbox 
                    label="Email"
                    [ngModel]="user()?.email" 
                    [isLoading]="_isLoading()" 
                    [isReadonly]="true"
                ></coer-textbox> 
            </div>
        }

        <!-- Partner -->
        @if(IsNotOnlyWhiteSpace(user()?.partner)) {
            <div class="flex-basis">
                <coer-textbox 
                    label="Partner"
                    [ngModel]="user()?.partner" 
                    [isLoading]="_isLoading()" 
                    [isReadonly]="true"
                ></coer-textbox> 
            </div> 
        }

        <!-- Role --> 
        @if(_roleList().length > 0) {
            <div class="flex-basis">
                <coer-selectbox 
                    label="Role"
                    [(ngModel)]="_role" 
                    [isLoading]="_isLoading()" 
                    [dataSource]="_roleList()"
                    [isReadonly]="_roleList().length <= 1"
                    (onValueChange)="_UpdateRole($event)"
                ></coer-selectbox> 
            </div>
        }   
    </div>
</coer-modal>


<coer-modal #passwordModal title="Change Password" icon="i91-lock-fill" (onClose)="_ResetPassword()" (onOpen)="passwordRef.Focus()">
    <div class="flex-wrap margin-top-15px max-width-300px margin-x-10px">
        <!-- Password -->
        <div class="flex-basis-300px flex-grow-1">
            <coer-secretbox
                #passwordRef
                label="Password"
                [(ngModel)]="_password" 
                [isLoading]="_isLoading()" 
                [isInvalid]="_isInvalidPassword()"
                marginTop="5px"
                (onKeyupEnter)="confirmRef.Focus()"
            ></coer-secretbox> 
        </div> 

        <!-- Confirm -->
        <div class="flex-basis-300px flex-grow-1">
            <coer-secretbox
                #confirmRef
                label="Confirm"
                [(ngModel)]="_confirm" 
                [isLoading]="_isLoading()" 
                [isInvalid]="_isInvalidConfirm()"
                marginTop="5px"
                marginBottom="10px"
                (onKeyupEnter)="buttonRef()?.Click()"
            ></coer-secretbox> 
        </div>
    </div>
    
    <ng-template templateRef="modal-footer">
        <coer-button
            #buttonRef
            label="Update"
            icon="save"
            color="success"
            [isLoading]="_isLoading()"
            marginRight="10px"
            [isReadonly]="_disableUpdatePassword()"
            (onClick)="onUpdatePassword.emit(_password())"
        ></coer-button>
    </ng-template>
</coer-modal>